# üöÄ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: Scanner 2.0 "Deep Impact"

**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ "110%", —ç–º—É–ª–∏—Ä—É—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å —Å–∞–π—Ç–æ–º, –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ç –∫—É–∫–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º.

> **Roadmap:** —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–∞–∑–µ **B (Depth & Coverage)** –∏–∑ [`ROADMAP.md`](./ROADMAP.md).
---

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ü–æ—Ç–æ–∫ (Workflow)

–¢–µ–∫—É—â–∏–π —Å–∫–∞–Ω–µ—Ä (v1) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —Å—Ç—Ä–∞–Ω–∏—Ü—É. Scanner 2.0 –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ **Crawler**.

### üîÑ –ù–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
1.  **Initial Load:** –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
2.  **Consent Interaction (Critical):**
    *   –ü–æ–∏—Å–∫ CMP (Consent Management Platform) –±–∞–Ω–Ω–µ—Ä–æ–≤ (Cookiebot, OneTrust, Borlabs, etc.).
    *   –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ –∫–Ω–æ–ø–∫—É "Ablehnen", "Reject All", "Nur Essenzielle".
    *   **–ö–ª–∏–∫!** -> –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–∏–ª–∏ –æ–∂–∏–¥–∞–Ω–∏–µ).
    *   **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –õ–µ—Ç—è—Ç –ª–∏ –∑–∞–ø—Ä–æ—Å—ã –∫ Google Analytics / Facebook Pixel *–ø–æ—Å–ª–µ* –æ—Ç–∫–∞–∑–∞? (–≠—Ç–æ —Å–∞–º–æ–µ –≥—Ä—É–±–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ).
3.  **Discovery:** –ü–æ–∏—Å–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.
    *   –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `Impressum`, `Datenschutz`, `Kontakt`, `Shop`, `Checkout`.
    *   –í—ã–±–æ—Ä 3-5 —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.
4.  **Deep Scan Loop (–¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã):**
    *   **Smart Scroll:** –°–∫—Ä–æ–ª–ª –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞ —Å –ø–∞—É–∑–∞–º–∏, —á—Ç–æ–±—ã —Å—Ä–∞–±–æ—Ç–∞–ª–∏ Lazy Loading –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Å–∫—Ä–∏–ø—Ç—ã.
    *   **Interaction:** –ï—Å–ª–∏ –µ—Å—Ç—å –∫–∞—Ä—Ç—ã (Google Maps) –∏–ª–∏ –≤–∏–¥–µ–æ (YouTube) —Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ -> –∫–ª–∏–∫ "Load anyway" (–ø—Ä–æ–≤–µ—Ä–∫–∞ 2-click solution).
    *   **Evidence:** –°–∫—Ä–∏–Ω—à–æ—Ç –æ–±–ª–∞—Å—Ç–∏ —Å –Ω–∞—Ä—É—à–µ–Ω–∏–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞).

---

## 2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (Playwright)

### üï∑Ô∏è A. Recursive Crawler (–õ–æ–≥–∏–∫–∞)
–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—á–µ—Ä–µ–¥—å URL.
```typescript
interface CrawlJob {
  url: string;
  depth: number;
  source: 'homepage' | 'internal';
}
const MAX_DEPTH = 1;
const MAX_PAGES = 5;
```

### üç™ B. Consent Interaction (–≠–≤—Ä–∏—Å—Ç–∏–∫–∞)
–ù–µ–ª—å–∑—è –ø–æ–ª–∞–≥–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã. –ù—É–∂–µ–Ω –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É (Text-based Locators), —Ç–∞–∫ –∫–∞–∫ –∫–ª–∞—Å—Å—ã –º–µ–Ω—è—é—Ç—Å—è.

**–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (German/English):**
- `Reject`, `Ablehnen`, `Nur notwendige`, `Verweigern`.
- `Accept`, `Akzeptieren`, `Alle zulassen` (–¥–ª—è —Ç–µ—Å—Ç–∞ "–ø–ª–æ—Ö–æ–≥–æ" —Å—Ü–µ–Ω–∞—Ä–∏—è).

**–õ–æ–≥–∏–∫–∞:**
```typescript
// –ü—Ä–∏–º–µ—Ä –Ω–∞ Playwright
const rejectButton = page.getByRole('button', { name: /ablehnen|reject|nur notwendige/i }).first();
if (await rejectButton.isVisible()) {
    await rejectButton.click();
    await page.waitForLoadState('networkidle');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ—è–≤–∏–ª–∏—Å—å –ª–∏ —Ç—Ä–µ–∫–µ—Ä—ã –ü–û–°–õ–ï –æ—Ç–∫–∞–∑–∞
}
```

### üìú C. Smart Scroll (–£–ª—É—á—à–µ–Ω–Ω—ã–π)
–¢–µ–∫—É—â–∏–π —Å–∫—Ä–æ–ª–ª –ø—Ä–æ—Å—Ç–æ –º–æ—Ç–∞–µ—Ç –≤–Ω–∏–∑. –£–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª –¥–æ–ª–∂–µ–Ω –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —á—Ç–µ–Ω–∏–µ.

```typescript
async function smartScroll(page) {
    let lastHeight = await page.evaluate('document.body.scrollHeight');
    while (true) {
        await page.mouse.wheel(0, 500); // –°–∫—Ä–æ–ª–ª –∫–æ–ª–µ—Å–æ–º, –∞ –Ω–µ JS (—Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç –±–æ–ª—å—à–µ —Å–æ–±—ã—Ç–∏–π)
        await page.waitForTimeout(200);
        let newHeight = await page.evaluate('document.body.scrollHeight');
        if (newHeight === lastHeight) break;
        lastHeight = newHeight;
    }
}
```

### üì∏ D. Evidence Gathering (–°–∫—Ä–∏–Ω—à–æ—Ç—ã)
–î–ª—è –∫–∞–∂–¥–æ–≥–æ `Finding` (–Ω–∞—Ä—É—à–µ–Ω–∏—è) –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç.
- –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ Google Map -> `element.screenshot()`.
- –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω —à—Ä–∏—Ñ—Ç -> —Å–∫—Ä–∏–Ω—à–æ—Ç Network Tab (—Å–ª–æ–∂–Ω–æ) –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–∫—Ä–∏–Ω—à–æ—Ç —Ö–µ–¥–µ—Ä–∞ —Å–∞–π—Ç–∞.

---

## 3. –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è (Roadmap)

### –≠—Ç–∞–ø 1: Smart Scroll & Basic Interaction (–ù–µ–¥–µ–ª—è 1)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `lib/scan-engine.ts`.
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å `window.scrollBy` –Ω–∞ `page.mouse.wheel`.
- [ ] –î–æ–±–∞–≤–∏—Ç—å –±–∞–∑–æ–≤—ã–π –∫–ª–∏–∫–µ—Ä –ø–æ –∫–Ω–æ–ø–∫–∞–º "Ablehnen".

### –≠—Ç–∞–ø 2: Multi-Page Crawling (–ù–µ–¥–µ–ª—è 2)
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç—á–µ—Ç–∞ (Report JSON), —á—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–∞–Ω–∏—Ü.
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–±–æ—Ä–∞ —Å—Å—ã–ª–æ–∫ (`a[href^="/"]`).
- [ ] –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ª–∏–º–∏—Ç (5 —Å—Ç—Ä–∞–Ω–∏—Ü), —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å –≤–æ—Ä–∫–µ—Ä.

### –≠—Ç–∞–ø 3: Evidence (–ù–µ–¥–µ–ª—è 3)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Supabase Storage –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤.
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –≤ –≤–æ—Ä–∫–µ—Ä.

---

## 4. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (Schema)

–¢–∞–±–ª–∏—Ü–∞ `scans` –¥–æ–ª–∂–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç—å JSON –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

```json
{
  "summary": {
    "score": 85,
    "total_violations": 12
  },
  "pages": [
    {
      "url": "https://example.com/",
      "findings": [...]
    },
    {
      "url": "https://example.com/impressum",
      "findings": [...]
    }
  ]
}
```
